/* Plugin Template generated by Pawn Studio */

#include <sourcemod>

#define PL_VERSION				"0.1"

#define CVAR_VERSION			0
#define CVAR_ENABLE				1
#define CVAR_CHEATS				2
#define NUM_CVARS				3

new Handle:g_cvars[NUM_CVARS];

public Plugin:myinfo = 
{
	name = "Nav Mesh Generator",
	author = "Jindo",
	description = "Generate the nav mesh for a map.",
	version = PL_VERSION,
	url = "http://www.topaz-games.com/"
}

public OnPluginStart()
{
	g_cvars[CVAR_VERSION] = CreateConVar("nmg_version", PL_VERSION, "Version of the plugin.", FCVAR_PLUGIN|FCVAR_NOTIFY|FCVAR_REPLICATED);
	g_cvars[CVAR_ENABLE] = CreateConVar("nmg_enable", "1", "Enable the plugin.");
	g_cvars[CVAR_CHEATS] = FindConVar("sv_cheats");
}

public OnMapStart()
{
	if (GetConVarInt(g_cvars[CVAR_ENABLE]))
	{
		decl String:map[64];
		GetCurrentMap(map, sizeof(map));
		Format(map, sizeof(map), "maps/%s.nav", map); // Something like this, I'm not 100% sure where the nav meshes are stored.
		if(!FileExists(map))
		{
			SetConVarFlags(g_cvars[CVAR_CHEATS], GetConVarFlags(g_cvars[CVAR_CHEATS])^FCVAR_NOTIFY);
			SetConVarBool(g_cvars[CVAR_CHEATS], true);
			ServerCommand("nav_generate");
			SetConVarBool(g_cvars[CVAR_CHEATS], false);
		}
	}
}