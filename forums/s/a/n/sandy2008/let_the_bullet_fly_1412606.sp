/* Plugin Template generated by Pawn Studio */

#include <sourcemod>

new Handle:g_Enabled,Handle:g_CAdd,Handle:g_MaxC,Handle:g_HpAdd,Handle:g_MaxHp

public Plugin:myinfo = 
{
	name = "Red Dead Bonus",
	author = "Sandy",
	description = "Gives someone Hp on a kill",
	version = "1.0",
	url = "sy7.5d6d.com"
}

public OnPluginStart()
{
	CreateConVar("kb_version", "1.0", "Red Dead Bonus", FCVAR_PLUGIN|FCVAR_SPONLY|FCVAR_REPLICATED|FCVAR_NOTIFY)
	g_Enabled	=	CreateConVar("bly_enabled", 	"1", 	"Plugin enbales or not", FCVAR_NOTIFY)
	g_CAdd	=	CreateConVar("bly_cash", 		"1000",	"value # the cash", FCVAR_NOTIFY)
	g_MaxHp	= 	CreateConVar("tzdbly_maxhp",	"100",	"value # the max hp", FCVAR_NOTIFY)
	g_HpAdd	=	CreateConVar("bly_hp", 		"20",	"value # the hp", FCVAR_NOTIFY)
	g_MaxC	= 	CreateConVar("tzdbly_maxcash",	"16000",	"value # the max cash", FCVAR_NOTIFY)	
	//HookEvent("player_death", hookPlayerDie, EventHookMode_Post)
	//HookEvent("player_death", hookPlayer, EventHookMode_Post)
	HookEvent("player_death", Event_PlayerDeath);
}
public Action:Event_PlayerDeath(Handle:event, const String:name[], bool:dontBroadcast)
{
	new attacker = GetClientOfUserId(GetEventInt(event, "attacker"));
	new Hp 	= GetConVarInt(g_HpAdd)
	new MaxHp = GetConVarInt(g_MaxHp)
	new CurrentHp	= GetClientHealth(attacker)
	
	if((CurrentHp + Hp) > MaxHp)
	{		
		//SetEntProp(attacker, Prop_Send, "m_iHealth", Max, 1)
		SetEntityHealth(attacker,MaxHp);
		
		PrintToChatAll( "\x04%N \x03gets %i hp", attacker,(MaxHp - CurrentHp))
	} 
	else 
	{
		//SetEntProp(attacker, Prop_Send, "m_iHealth", Hp + CurrentHp, 1)
		SetEntityHealth(attacker,Hp + CurrentHp);	
		
		PrintToChatAll("\x04%N \x03gets %i hp",attacker, Hp)
	}	
	
	if(GetConVarBool(g_Enabled))
		return;
	
	new victim = GetClientOfUserId(GetEventInt(event, "userid"));
	new C 	= GetConVarInt(g_CAdd)
	new Max = GetConVarInt(g_MaxC)
	new CurrentC	=  GetClientMoney(victim)
	
	if((CurrentC + C) > Max)
	{		
		//SetEntProp(id, Prop_Send, "m_iAccount", Max, 1)
		SetClientMoney(victim,Max)
		
		PrintCenterTextAll("\x04%N \x03gets %i money" , victim,(Max - CurrentC))
	} 
	else 
	{
		//SetEntProp(id, Prop_Send, "m_iAccount", C + CurrentC, 1)
		SetClientMoney(victim,C + CurrentC);
		
		PrintCenterTextAll("\x04%N \x03gets %i money" ,victim,C)
	}	
	
}

