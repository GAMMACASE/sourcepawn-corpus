/* Plugin Template generated by Pawn Studio */

#include <sourcemod>
#include <sdktools>

public Plugin:myinfo = 
{
	name = "L4D Ledge Release",
	author = "Crimson",
	description = "Player's can Release from Ledge with the Use key",
	version = "1.0.0",
	url = "http://www.sourcemod.net"
}

public OnPluginStart()
{	
	HookEvent("player_use", Event_PlayerUse);
}

public Event_PlayerUse(Handle:event, const String:name[], bool:dontBroadcast)
{
	new client = GetClientOfUserId(GetEventInt(event, "userid"));
	new bHanging = GetEntProp(client, Prop_Send, "m_isHangingFromLedge", 1);
	
	if(bHanging)
	{
		PrintToConsole(client, "[DEBUG] Client Pressed Use, Prop is %d", bHanging);
		FakeClientCommand(client, "explode");
	}
	else
	{
		PrintToConsole(client, "[DEBUG] Client Pressed Use, Prop is %d", bHanging);
	}
}