//////////////////////////////////////////////////////////////////
// CS:S DM Startfix By HSFighter / www.hsfighter.net			//
//////////////////////////////////////////////////////////////////

#include <sourcemod>
#pragma semicolon 1
#define PLUGIN_VERSION "0.1.0"

//////////////////////////////////////////////////////////////////
// Delcare Variables and Handles
//////////////////////////////////////////////////////////////////

new Handle:DMFixEnabled;
new Handle:CSSDMEnabeld;

new Handle:MAhandle;


//////////////////////////////////////////////////////////////////
// Plugin Info
//////////////////////////////////////////////////////////////////

public Plugin:myinfo = 
{
	name = "CS:S DM Startfix",
	author = "HSFighter",
	description = "Fix startstuck of cssdm_enabeld",
	version = PLUGIN_VERSION,
	url = "http://www.hsfighter.net"
}

//////////////////////////////////////////////////////////////////
// Start Plugin 
//////////////////////////////////////////////////////////////////

public OnPluginStart()
{
	CreateConVar("dmfix_version", PLUGIN_VERSION, "CS:S DM Startfix Version", FCVAR_PLUGIN|FCVAR_SPONLY|FCVAR_REPLICATED|FCVAR_NOTIFY);
	DMFixEnabled = CreateConVar("dmfix_enabled", "1", "Enables/Disables CS:S DM Startfix");	
	
	CSSDMEnabeld = FindConVar("cssdm_enabled");
}

//////////////////////////////////////////////////////////////////
// Start Map
//////////////////////////////////////////////////////////////////

public OnMapStart(){
	
		CreateTimer(1.0, Timeleft_Start);	
}

//////////////////////////////////////////////////////////////////
// Create Timer for Delay
//////////////////////////////////////////////////////////////////

public Action:Timeleft_Start(Handle:timer){

		MAhandle = CreateTimer(1.0, Checktime, INVALID_HANDLE, TIMER_REPEAT);
}

//////////////////////////////////////////////////////////////////
// Wait, check ConVars and enable CS:S DM
//////////////////////////////////////////////////////////////////

public Action:Checktime(Handle:timer){
	
    // Check if CS:S DM Startfix is enabeld
	if(GetConVarInt(DMFixEnabled) != 1) return;

    // Check if CS:S DM is enabeld is disabled
	if(GetConVarInt(CSSDMEnabeld) != 1){
		//Enable CS:S DM and close timer
	    ServerCommand("cssdm_enabled 1");
	    CloseHandle(timer);
    }
}    

//////////////////////////////////////////////////////////////////
// Close Handles
//////////////////////////////////////////////////////////////////

public OnPluginEnd(){

	 CloseHandle(MAhandle);
}

//////////////////////////////////////////////////////////////////
// End Plugin
//////////////////////////////////////////////////////////////////