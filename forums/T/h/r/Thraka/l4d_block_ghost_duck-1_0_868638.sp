/* Plugin Template generated by Pawn Studio */

#include <sourcemod>

#define CVAR_FLAGS FCVAR_PLUGIN
#define PLUGIN_VERSION "1.0"

public Plugin:myinfo = 
{
	name = "[L4D] Block Ghost Duck",
	author = "Thraka",
	description = "Forces a player (on spawn) to duck-unduck. Prevents ghosts from using exploits.",
	version = PLUGIN_VERSION,
	url = "http://forums.alliedmods.net/showthread.php?p=868638"
}

public OnPluginStart()
{
	CreateConVar("l4d_ghost_duck_block_ver", PLUGIN_VERSION, "Version of the ghost block plugin.", FCVAR_PLUGIN|FCVAR_SPONLY|FCVAR_NOTIFY);
	HookEvent("player_spawn", Player_Spawn);
}

public Player_Spawn(Handle:event, const String:name[], bool:dontBroadcast)
{
	new client = GetClientOfUserId(GetEventInt(event, "userid"));
	CreateTimer(0.1, DuckPlayer, client);
}

public Action:DuckPlayer(Handle:timer, any:client)
{
	if (IsFakeClient(client))
		FakeClientCommand(client, "+duck");
	else
		ClientCommand(client, "+duck");	
	
	CreateTimer(0.01, UnDuckPlayer, client);
}

public Action:UnDuckPlayer(Handle:timer, any:client)
{
	if (IsFakeClient(client))
		FakeClientCommand(client, "-duck");
	else
		ClientCommand(client, "-duck");	
}