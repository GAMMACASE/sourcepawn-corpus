#pragma semicolon 1
#include <sourcemod>
#include <sdktools>


public Plugin:myinfo =
{
	name = "L4D2_Block_Idle_Exploit",
	author = "Lux",
	description = "",
	version = "",
	url = ""
};

public void OnPluginStart()
{
	AddCommandListener(ShouldAllowAFK, "go_away_from_keyboard");
}

bool ShouldBlockIdle(int iClient)
{
	if(GetEntPropEnt(iClient, Prop_Send, "m_pummelAttacker") > 0)
		return true;
	if(GetEntPropEnt(iClient, Prop_Send, "m_carryAttacker") > 0)
		return true;
	if(GetEntPropEnt(iClient, Prop_Send, "m_pounceAttacker") > 0)
		return true;
	if(GetEntPropEnt(iClient, Prop_Send, "m_jockeyAttacker") > 0)
		return true;
	if(GetEntPropEnt(iClient, Prop_Send, "m_tongueOwner") > 0)
		return true;
	return false;
}
public Action ShouldAllowAFK(int iClient, const char[] sCommand, int iArg)
{
	if(iClient < 1 || iClient > MaxClients || !IsClientInGame(iClient)
		|| GetClientTeam(iClient) != 2 || !IsPlayerAlive(iClient))
			return Plugin_Continue;
	
	if(ShouldBlockIdle(iClient))
		return Plugin_Handled;
	return Plugin_Continue;
}
