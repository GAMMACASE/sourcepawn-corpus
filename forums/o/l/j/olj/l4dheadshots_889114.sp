/* Plugin Template generated by Pawn Studio */

#include <sourcemod>

//new Handle:hEasyHeadDamage = INVALID_HANDLE;
//new Handle:hExpertHeadDamage = INVALID_HANDLE;
//new Handle:hHardHeadDamage = INVALID_HANDLE;
//new Handle:hNormalHeadDamage = INVALID_HANDLE;
new Handle:CvarArray[4];
new Handle:cEnableHeadshotsOnly = INVALID_HANDLE;

public Plugin:myinfo = 
{
	name = "L4D HeadShots Only",
	author = "Crimson",
	description = "http://www.sourcemod.net",
	version = "1.0.0",
	url = "http://www.brutalservers.net"
}

public OnPluginStart()
{
CvarArray[0] = FindConVar("z_non_head_damage_factor_easy");
CvarArray[1] = FindConVar("z_non_head_damage_factor_expert");
CvarArray[2] = FindConVar("z_non_head_damage_factor_hard");
CvarArray[3] = FindConVar("z_non_head_damage_factor_normal");
	//hEasyHeadDamage = FindConVar("z_non_head_damage_factor_easy");
	//hExpertHeadDamage = FindConVar("z_non_head_damage_factor_expert");
	//hHardHeadDamage = FindConVar("z_non_head_damage_factor_hard");
	//hNormalHeadDamage = FindConVar("z_non_head_damage_factor_normal");
cEnableHeadshotsOnly = CreateConVar("sm_headshots_only", "0", "Enable/Disable Headshots on Infected Only", _, true, 0.0, true, 1.0);
}

public OnConfigsExecuted()
{
	HookConVarChange(cEnableHeadshotsOnly, ConVarChange_HeadshotsOnly);
}

public ConVarChange_HeadshotsOnly(Handle:convar, const String:oldValue[], const String:newValue[])
{
	new enabled
	if(StrEqual(newValue, "1")) enabled = 0;
	else if(StrEqual(newValue, "0")) enabled = 1;
	for (new i = 0; i < sizeof(CvarArray); i++)
		{
			new String:var[256];
			GetConVarName(CvarArray[i], var, 256);
			new flags = GetCommandFlags(var);
			SetCommandFlags(var, flags & ~FCVAR_CHEAT);
			SetConVarInt(CvarArray[i], enabled, false, false);
			SetCommandFlags(var, flags);
		}	
}