/* Plugin Template generated by Pawn Studio */

#include <sourcemod>
#include <tf2_stocks>

public Plugin:myinfo = 
{
	name = "Admin Respawn",
	author = "Acdervis",
	description = "Grants adjustable fast respawn to specified admin flag.",
	version = "1.0",
	url = "www.xkafe.net"
}

new Handle:g_RespawnInterval
new bool:roundactive

public OnPluginStart()
{
	g_RespawnInterval = CreateConVar("sm_adminrespawntime", "5.0", "Time(seconds) to use when respawning admins.");
	HookEvent("player_death", Hook_playerdeath);
	HookEvent("teamplay_round_win", Hook_RoundWon);
	HookEvent("teamplay_round_start", Hook_RoundStart);
}

public Hook_playerdeath(Handle:event, const String:name[], bool:DontBroadcast)
{
	if(roundactive)
	{
		new clientID = GetClientOfUserId(GetEventInt(event, "userid"));
		new flags = GetUserFlagBits(clientID);
		if(IsClientConnected(clientID) && flags & ADMFLAG_CUSTOM6)
		{
			CreateTimer(GetConVarFloat(g_RespawnInterval), Command_Respawn, clientID);
		}
	}
}

public Hook_RoundWon(Handle:event, const String:name[], bool:DontBroadcast)
{
	roundactive = false;
}

public Hook_RoundStart(Handle:event, const String:name[], bool:DontBroadcast)
{
	roundactive = true;
}

public Action:Command_Respawn(Handle:timer, any:clientID)
{
	if(!IsPlayerAlive(clientID) && IsClientInGame(clientID))
	{
		TF2_RespawnPlayer(clientID);
	}
}