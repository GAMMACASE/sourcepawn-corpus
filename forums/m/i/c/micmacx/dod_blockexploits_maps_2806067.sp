#include <sourcemod>
#include <sdktools>

#define PLUGIN_VERSION "1.2"

new Handle:Cvar_Random_Enable;

public Plugin:myinfo = 
{
	name = "DoD BlockExploits, modif only maps",
	author = "FeuerSturm + darkranger, vintage, Micmacx",
	description = "Map bugfix, improvement and a little mod.",
	version = PLUGIN_VERSION,
	url = "http://www.dodsplugins.com"
}

public OnPluginStart()
{
	CreateConVar("dod_blockexploitmaps_version", PLUGIN_VERSION, "DoD plugin Version", FCVAR_DONTRECORD | FCVAR_SPONLY | FCVAR_REPLICATED | FCVAR_NOTIFY);
	Cvar_Random_Enable = CreateConVar("dod_randommdl", "1", "0 : disable random mdl, 1 : enable random mdl", FCVAR_SPONLY|FCVAR_REPLICATED|FCVAR_NOTIFY);
	AutoExecConfig(true, "dod_blockexploitmaps", "dod_blockexploitmaps");
	HookEventEx("dod_round_start", OnRound, EventHookMode_Post)
}

public OnMapStart()
{
	PrecacheModel("models/props_foliage/rock_coast02h.mdl")
	PrecacheModel("models/props_crates/static_crate_40.mdl")
	PrecacheModel("models/props_debris/walldestroyed03a.mdl")
	PrecacheModel("models/props_doors/doorframe_07a.mdl")
	PrecacheModel("models/props_debris/walldestroyed05a.mdl")
	PrecacheModel("models/props_debris/walldestroyed08a.mdl")
	PrecacheModel("models/props_vehicles/sherman_tank.mdl")
	PrecacheModel("models/props_vehicles/tiger_tank.mdl")
}

public Action:OnRound(Handle:event, const String:name[], bool:dontBroadcast)
{
	new String:mapname[256]
	GetCurrentMap(mapname, sizeof(mapname))
	if(StrContains(mapname, "dod_flash", false) != -1)
	{
		new entid = -1
		while((entid = FindEntityByClassname(entid, "prop_physics_multiplayer")) != -1)
		{
			new Float:Origin[3]
			GetEntPropVector(entid, Prop_Send, "m_vecOrigin", Origin)
			new iOrigin[3]
			iOrigin[0] = RoundFloat(Origin[0])
			iOrigin[1] = RoundFloat(Origin[1])
			iOrigin[2] = RoundFloat(Origin[2])
			if(iOrigin[0] == 236 && iOrigin[1] == -1542 && iOrigin[2] == 92)
			{
				RemoveCrate(entid)
				return Plugin_Continue
			}
		}
	}
	if(StrEqual(mapname, "dod_anzio", false)) CreateTimer(0.1, SpawnRock, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_avalanche", false)) CreateTimer(0.1, SpawnTeamWall, _, TIMER_FLAG_NO_MAPCHANGE)
	if((StrContains(mapname, "dod_donner", false) != -1 || StrEqual(mapname, "dod_winter", false))) CreateTimer(0.1, SpawnDonnerTeamWall, _, TIMER_FLAG_NO_MAPCHANGE)

	if(GetConVarBool(Cvar_Random_Enable))
	{
		if(StrEqual(mapname, "3xi_trainmap", false)) CreateTimer(0.1, Spawn3xitrain, _, TIMER_FLAG_NO_MAPCHANGE)
		if(StrEqual(mapname, "dod_fight_arena_urbex", false)) CreateTimer(0.1, Spawnurbex, _, TIMER_FLAG_NO_MAPCHANGE)
		if(StrEqual(mapname, "3xi_urbex", false)) CreateTimer(0.1, Spawnurbex, _, TIMER_FLAG_NO_MAPCHANGE)
		if(StrEqual(mapname, "dod_bunky", false)) CreateTimer(0.1, SpawnBunky, _, TIMER_FLAG_NO_MAPCHANGE)
		if(StrEqual(mapname, "dod_fight_arena", false)) CreateTimer(0.1, FightArena, _, TIMER_FLAG_NO_MAPCHANGE)
		if(StrEqual(mapname, "dod_normandie_fight_arena", false)) CreateTimer(0.1, NormandieFightArena, _, TIMER_FLAG_NO_MAPCHANGE)
	}
	if(StrEqual(mapname, "dod_bodange", false)) CreateTimer(0.1, SpawnBodangeWall, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_convoy_b20", false) || StrEqual(mapname, "dod_convoy", false) || StrEqual(mapname, "dod_convoy2_rc1", false) || StrEqual(mapname, "dod_convoy2_rc1_fixed", false)) CreateTimer(0.1, SpawnConvoy, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_convoy_summer", false) || StrEqual(mapname, "dod_convoy_summer_final", false)) CreateTimer(0.1, SpawnConvoysummer, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_convoy_new_noel", false) || StrEqual(mapname, "dod_convoy_new_year_2011", false)) CreateTimer(0.1, SpawnConvoynewyear, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_crash_dust", false) || StrEqual(mapname, "dod_crash_dust_final", false)) CreateTimer(0.1, SpawnCrashDust, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_deux_chateaux_final", false) || StrEqual(mapname, "dod_deux_chateaux_LS", false) || StrEqual(mapname, "dod_deux_chateaux", false)) CreateTimer(0.1, SpawnDeuxChateaux, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_fightzone_voodoo", false) || StrEqual(mapname, "dod_fightzone_voodoo_final", false)) CreateTimer(0.1, SpawnVodooWall, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_gan", false) || StrEqual(mapname, "dod_gan_32", false) || StrEqual(mapname, "dod_gan_xmas_b1", false) || StrEqual(mapname, "dod_gan32", false)) CreateTimer(0.1, SpawnGan, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_gan_extended_se", false)) CreateTimer(0.1, SpawnGanext, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "dod_mario_air", false)) CreateTimer(0.1, SpawnMarioAirWall, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "mario_air_32", false) || StrEqual(mapname, "mario_air", false)) CreateTimer(0.1, SpawnMarioAir32Wall, _, TIMER_FLAG_NO_MAPCHANGE)
	if(StrEqual(mapname, "cdc_mario_air_flag", false)) CreateTimer(0.1, SpawnMarioAirFlagWall, _, TIMER_FLAG_NO_MAPCHANGE)

	return Plugin_Continue
}

RemoveCrate(entid)
{
	RemoveEdict(entid)
	new Crate = CreateEntityByName("prop_physics_override")
	SetEntityModel(Crate, "models/props_crates/static_crate_40.mdl")
	new Float:Origin[3]
	Origin[0] = 235.582992
	Origin[1] = -1542.420043
	Origin[2] = 92.415199
	DispatchKeyValueVector(Crate, "origin", Origin)
	DispatchKeyValue(Crate, "angles", "-0.002285 74.865623 0.068640")
	DispatchKeyValue(Crate, "spawnflags", "1544")
	DispatchSpawn(Crate)
}

public SpawnCrate(Float:Origin[3], String:Angles[])
{
	new Wall = CreateEntityByName("prop_physics_override")
	SetEntityModel(Wall, "models/props_crates/static_crate_40.mdl")
	DispatchKeyValueVector(Wall, "origin", Origin)
	DispatchKeyValue(Wall, "angles", Angles)
	DispatchKeyValue(Wall, "disableshadows", "1")
	DispatchKeyValue(Wall, "spawnflags", "1544")
	DispatchSpawn(Wall)
}

public SpawnTankGer(Float:Origin[3], String:Angles[])
{
	new Wall = CreateEntityByName("prop_physics_override")
	SetEntityModel(Wall, "models/props_vehicles/sherman_tank.mdl")
	DispatchKeyValueVector(Wall, "origin", Origin)
	DispatchKeyValue(Wall, "angles", Angles)
	DispatchKeyValue(Wall, "disableshadows", "1")
	DispatchKeyValue(Wall, "spawnflags", "1544")
	DispatchSpawn(Wall)
}

public SpawnTankAmer(Float:Origin[3], String:Angles[])
{
	new Wall = CreateEntityByName("prop_physics_override")
	SetEntityModel(Wall, "models/props_vehicles/tiger_tank.mdl")
	DispatchKeyValueVector(Wall, "origin", Origin)
	DispatchKeyValue(Wall, "angles", Angles)
	DispatchKeyValue(Wall, "disableshadows", "1")
	DispatchKeyValue(Wall, "spawnflags", "1544")
	DispatchSpawn(Wall)
}

public SpawnHouseWall(Float:Origin[3], String:Angles[])
{
	new Wall = CreateEntityByName("prop_physics_override")
	SetEntityModel(Wall, "models/props_debris/walldestroyed03a.mdl")
	DispatchKeyValueVector(Wall, "origin", Origin)
	DispatchKeyValue(Wall, "angles", Angles)
	DispatchKeyValue(Wall, "disableshadows", "1")
	DispatchKeyValue(Wall, "spawnflags", "1544")
	DispatchSpawn(Wall)
}

public SpawnHouseDoor()
{
	new Door = CreateEntityByName("prop_physics_override")
	SetEntityModel(Door, "models/props_doors/doorframe_07a.mdl")
	new Float:Origin[3]
	Origin[0] = 589.0
	Origin[1] = -436.0
	Origin[2] = -123.0
	DispatchKeyValueVector(Door, "origin", Origin)
	DispatchKeyValue(Door, "angles", "0.0 180.0 0.0")
	DispatchKeyValue(Door, "disableshadows", "1")
	DispatchKeyValue(Door, "spawnflags", "1544")
	DispatchSpawn(Door)
}

public Action:SpawnRock(Handle:timer)
{
	new Rock = CreateEntityByName("prop_physics_override")
	SetEntityModel(Rock, "models/props_foliage/rock_coast02h.mdl")
	new Float:Origin[3]
	Origin[0] = 639.0
	Origin[1] = -173.0
	Origin[2] = -450.0
	DispatchKeyValueVector(Rock, "origin", Origin)
	DispatchKeyValue(Rock, "angles", "0.0 295.883 0.0")
	DispatchKeyValue(Rock, "spawnflags", "1544")
	DispatchSpawn(Rock)
}

public Action:SpawnTeamWall(Handle:timer)
{
	new Float:Origin[3]
	Origin[0] = 1180.0
	Origin[1] = -725.0
	Origin[2] = -10.0
	CreateTeamWall(Origin)
	Origin[2] = 10.0
	CreateTeamWall(Origin)
	Origin[2] = 28.0
	CreateTeamWall(Origin)
	Origin[2] = 45.0
	CreateTeamWall(Origin)
	Origin[0] = -605.0
	Origin[1] = 340.0
	Origin[2] = 271.0
	new Wall = CreateEntityByName("prop_physics_override")
	SetEntityModel(Wall, "models/props_debris/walldestroyed08a.mdl")
	DispatchKeyValueVector(Wall, "origin", Origin)
	DispatchKeyValue(Wall, "angles", "0.0 185.0 0.0")
	DispatchKeyValue(Wall, "disableshadows", "1")
	DispatchKeyValue(Wall, "spawnflags", "1544")
	DispatchSpawn(Wall)
	return Plugin_Handled
}

public Action:SpawnMarioAirFlagWall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"270.0 90.0 0.0")
	Origin[0] = -687.0
	Origin[1] = -556.0
	Origin[2] = -923.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"270.0 90.0 0.0")
	Origin[0] = -687.0
	Origin[1] = -556.0
	Origin[2] = -723.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"90.0 90.0 0.0")
	Origin[0] = -101.0 //-5 plat
	Origin[1] = -1802.0 //-5
	Origin[2] = 1526.0
	SpawnHouseWall(Origin, Angles)
	
	new entity;
	decl String:targetname[256];
	while ((entity = FindEntityByClassname(entity, "info_teleport_destination")) != -1)
	{
		GetEntPropString(entity, Prop_Data, "m_iName", targetname, sizeof(targetname));
//		if(StrEqual(targetname, "tele90")) DispatchKeyValue(entity, "origin", "-595 -112 -1024"); //affiche pour test mario standard
		if(StrEqual(targetname, "telesec")) DispatchKeyValue(entity, "origin", "561.042846 905.782470 -2145.201416"); //ok TP vers pi√®ce transparente bas
		if(StrEqual(targetname, "cdc")) DispatchKeyValue(entity, "origin", "561.042846 905.782470 -2145.201416"); //ok piece secrete transparente haut
		if(StrEqual(targetname, "tunnel")) DispatchKeyValue(entity, "origin", "561.042846 905.782470 -2145.201416"); //ok Tp Entr√©e tunnel
		if(StrEqual(targetname, "killas")) DispatchKeyValue(entity, "origin", "561.042846 905.782470 -2145.201416"); //ok Tp vers le sky au dessus des lettres
	}

//coord actuelles 0 : 355.105773 , 1 : -1807.333984 , 2 : 1401.031250 piece haut transparente
}

public Action:SpawnVodooWall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 41.0 0.0")
	Origin[0] = 2212.0
	Origin[1] = 510.0
	Origin[2] = -69.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 319.2 0.0")
	Origin[0] = 581.0
	Origin[1] = 529.0
	Origin[2] = -82.0
	SpawnHouseWall(Origin, Angles)
}

public Action:SpawnDeuxChateaux(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 90.0 0.0")
	Origin[0] = -989.256591
	Origin[1] = 792.678894
	Origin[2] = -0.343261
	SpawnTankAmer(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 270.0 0.0")
	Origin[0] = -989.181030
	Origin[1] = -730.357421
	Origin[2] = -0.001178
	SpawnTankAmer(Origin, Angles)
	Format(Angles, sizeof(Angles),"355.0 0.0 0.0")
	Origin[0] = 0.421279
	Origin[1] = -714.021850
	Origin[2] = 3.731113
	SpawnTankGer(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 0.0")
	Origin[0] = 0.421279
	Origin[1] = 778.596740
	Origin[2] = 0.632932
	SpawnTankGer(Origin, Angles)
}

public Action:SpawnConvoy(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Alli√©
	Origin[0] = -986.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -721.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = -541.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -276.0
	Origin[1] = -2368.0
	Origin[2] = -89.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 216.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 481.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 681.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 946.0
	Origin[1] = -2368.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)

	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Axis
	Origin[0] = -986.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -721.0
	Origin[1] = 324.0
	Origin[2] = -89.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = -541.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -276.0
	Origin[1] = 324.0
	Origin[2] = -89.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 216.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 481.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 681.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 946.0
	Origin[1] = 324.0
	Origin[2] = -89.0
	SpawnHouseWall(Origin, Angles)
}

public Action:SpawnConvoynewyear(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Alli√©
	Origin[0] = -1036.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -771.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = -591.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -326.0
	Origin[1] = -1265.0
	Origin[2] = 212.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 166.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 431.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 631.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 896.0
	Origin[1] = -1265.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)

	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Axis
	Origin[0] = -1036.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -771.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = -591.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -326.0
	Origin[1] = 1400.0
	Origin[2] = 212.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 166.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 431.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 631.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 896.0
	Origin[1] = 1400.0
	Origin[2] = 212.0
	SpawnHouseWall(Origin, Angles)
}

//new year     866 -1003 ==> 1869/2 = 934
//summer axis 1566 -414  ==> 1980/2 = 990
public Action:SpawnConvoysummer(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Alli√©
	Origin[0] = -397.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -132.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 68.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 333.0
	Origin[1] = -3395.0
	Origin[2] = -630.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 819.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 1084.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 1284.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 1549.0
	Origin[1] = -3395.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)

	Format(Angles, sizeof(Angles),"0.0 180.0 180.0") //Axis
	Origin[0] = -397.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -132.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 68.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 333.0
	Origin[1] = -555.0
	Origin[2] = -630.0	
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 819.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 1084.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 1284.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 1549.0
	Origin[1] = -555.0
	Origin[2] = -630.0
	SpawnHouseWall(Origin, Angles)
}

public Action:SpawnGan(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 2478.0
	Origin[1] = -249.0
	Origin[2] = 208.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 2213.0
	Origin[1] = -249.0
	Origin[2] = 208.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 413.0
	Origin[1] = -249.0
	Origin[2] = 208.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 148.0
	Origin[1] = -249.0
	Origin[2] = 208.0
	SpawnHouseWall(Origin, Angles)
}

public Action:SpawnGanext(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = -1144.0
	Origin[1] = 433.0
	Origin[2] = -100.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = -876.0
	Origin[1] = 433.0
	Origin[2] = -100.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 180.0 180.0")
	Origin[0] = 881.0
	Origin[1] = 433.0
	Origin[2] = -100.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"0.0 0.0 180.0")
	Origin[0] = 1149.0
	Origin[1] = 433.0
	Origin[2] = -100.0
	SpawnHouseWall(Origin, Angles)
}

public Action:SpawnMarioAirWall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"270.0 90.0 90.0")
	Origin[0] = -1024.0
	Origin[1] = -880.0
	Origin[2] = -519.0
	SpawnHouseWall(Origin, Angles)
	Origin[0] = -1024.0
	Origin[1] = -880.0
	Origin[2] = -419.0
	SpawnHouseWall(Origin, Angles)
/*	Format(Angles, sizeof(Angles),"270.0 90.0 0.0") //tout en haut.
	Origin[0] = 1396.0
	Origin[1] = -2040.0
	Origin[2] = 2190.0
	SpawnHouseWall(Origin, Angles)*/
	new entity;
	decl String:targetname[256];
	while ((entity = FindEntityByClassname(entity, "info_teleport_destination")) != -1)
	{
		GetEntPropString(entity, Prop_Data, "m_iName", targetname, sizeof(targetname));
		if(StrEqual(targetname, "telesec")) DispatchKeyValue(entity, "origin", "1094 -108 2903");
		if(StrEqual(targetname, "tele90")) DispatchKeyValue(entity, "origin", "947.556030 -169.300781 2905");
	}
}

public Action:SpawnMarioAir32Wall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"270.0 90.0 90.0")
	Origin[0] = -1024.0
	Origin[1] = -880.0
	Origin[2] = -519.0
	SpawnHouseWall(Origin, Angles)
	Origin[0] = -1024.0
	Origin[1] = -880.0
	Origin[2] = -419.0
	SpawnHouseWall(Origin, Angles)
	new entity;
	decl String:targetname[256];
	while ((entity = FindEntityByClassname(entity, "info_teleport_destination")) != -1)
	{
		GetEntPropString(entity, Prop_Data, "m_iName", targetname, sizeof(targetname));
		if(StrEqual(targetname, "telesec")) DispatchKeyValue(entity, "origin", "1094 -108 2906");
	}
}

public Action:Spawn3xitrain(Handle:timer)
{
	if(GetRandomInt(0, 1) == 1)
	{
		new Float:Origin[3]
		new String:Angles[256]
		Format(Angles, sizeof(Angles),"0.0 180.0 0.0")
		Origin[0] = 136.290802
		Origin[1] = 172.970870
		Origin[2] = 10.031250
		SpawnTankAmer(Origin, Angles)
		Format(Angles, sizeof(Angles),"0.0 90.0 0.0")
		Origin[0] = 1771.989135
		Origin[1] = -731.000427
		Origin[2] = 10.031250
		SpawnTankGer(Origin, Angles)
	}
}

public Action:Spawnurbex(Handle:timer)
{
	if(GetRandomInt(0, 1) == 1)
	{
		new Float:Origin[3]
		new String:Angles[256]
		Format(Angles, sizeof(Angles),"0.0 0.0 0.0")
		Origin[0] = -161.106994
		Origin[1] = 469.244476
		Origin[2] = 10.031250
		SpawnTankAmer(Origin, Angles)
		Format(Angles, sizeof(Angles),"0.0 270.0 0.0")
		Origin[0] = 1923.743041
		Origin[1] = -787.918518
		Origin[2] = 10.031250
		SpawnTankGer(Origin, Angles)
	}
}

public Action:SpawnBunky(Handle:timer)
{
	if(GetRandomInt(0, 1) == 1)
	{
		new Float:Origin[3]
		new String:Angles[256]
		Format(Angles, sizeof(Angles),"0.0 0.0 0.0")
		Origin[0] = -70.147903
		Origin[1] = 287.850311
		Origin[2] = -113.112007
		SpawnTankAmer(Origin, Angles)
		Format(Angles, sizeof(Angles),"15.0 270.0 0.0")
		Origin[0] = 101.516952
		Origin[1] = 1046.638671
		Origin[2] = 104.925659
		SpawnTankGer(Origin, Angles)
	}
}

public Action:FightArena(Handle:timer)
{
	if(GetRandomInt(0, 1) == 1)
	{
		new Float:Origin[3]
		new String:Angles[256]
		Format(Angles, sizeof(Angles),"0.0 45.0 0.0")
		Origin[0] = 255.891494
		Origin[1] = -119.349166
		Origin[2] = 10.031250
		SpawnTankAmer(Origin, Angles)
		Format(Angles, sizeof(Angles),"0.0 315.0 0.0")
		Origin[0] = 1529.772583
		Origin[1] = -144.026822
		Origin[2] = 10.031250
		SpawnTankGer(Origin, Angles)
	}
}

public Action:NormandieFightArena(Handle:timer)
{
	if(GetRandomInt(0, 1) == 1)
	{
		new Float:Origin[3]
		new String:Angles[256]
		Format(Angles, sizeof(Angles),"0.0 45.0 0.0")
		Origin[0] = 1649.809204
		Origin[1] = -334.813690
		Origin[2] = 9.746192
		SpawnTankAmer(Origin, Angles)
		Format(Angles, sizeof(Angles),"0.0 90.0 346.0")
		Origin[0] = 447.926879
		Origin[1] = -78.665306
		Origin[2] = 30.533996
		SpawnTankGer(Origin, Angles)
	}
}

public Action:SpawnCrashDust(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 0.0 0.0")
	Origin[0] = 1339.0
	Origin[1] = 296.0
	Origin[2] = -115.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -225.0
	Origin[2] = -122.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -185.0
	Origin[2] = -122.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -145.0
	Origin[2] = -122.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -225.0
	Origin[2] = -82.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -185.0
	Origin[2] = -82.0
	SpawnCrate(Origin, Angles)
	Origin[0] = 1092.0
	Origin[1] = -145.0
	Origin[2] = -82.0
	SpawnCrate(Origin, Angles)
	new entity;
	while ((entity = FindEntityByClassname(entity, "prop_dynamic")) != -1)
	{
		GetEntPropVector(entity, Prop_Send, "m_vecOrigin", Origin)
		if(Origin[0] == 6 && Origin[1] == -506 && Origin[2] == -99)
		{
			DispatchKeyValue(entity, "origin", "6 -506 -400");
		}
	}
	Format(Angles, sizeof(Angles),"0.0 90.0 0.0")
	Origin[0] = -15.566528
	Origin[1] = -513.271423
	Origin[2] = -120.920776
	SpawnTankGer(Origin, Angles)
}

public Action:SpawnBodangeWall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Format(Angles, sizeof(Angles),"0.0 360.0 0.0")
	Origin[0] = 568.0
	Origin[1] = -1661.0
	Origin[2] = 36.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"180.0 180.0 0.0")
	Origin[0] = 583.0
	Origin[1] = -1661.0
	Origin[2] = 159.0
	SpawnHouseWall(Origin, Angles)
	Format(Angles, sizeof(Angles),"180.0 0.0 0.0")
	Origin[0] = 358.0
	Origin[1] = -1661.0
	Origin[2] = 159.0
	SpawnHouseWall(Origin, Angles)
}


public Action:SpawnDonnerTeamWall(Handle:timer)
{
	new Float:Origin[3]
	new String:Angles[256]
	Origin[0] = -864.0
	Origin[1] = 410.4
	Origin[2] = 2.8
	CreateDonnerTeamWall(Origin)
	Origin[0] = -418.9
	Origin[1] = -267.8
	Origin[2] = 12.3
	CreateDonnerTeamWall(Origin)
	Origin[0] = -431.8
	Origin[1] = -267.8
	Origin[2] = 36.3
	CreateDonnerTeamWall(Origin)
	Origin[0] = -453.9
	Origin[1] = -267.8
	Origin[2] = 36.0
	CreateDonnerTeamWall(Origin)
	Origin[0] = -865.0
	Origin[1] = -1434.0
	Origin[2] = -44.0
	Format(Angles, sizeof(Angles),"0.0 360.0 0.0")
	SpawnHouseWall(Origin, Angles)
	Origin[0] = -862.0
	Origin[1] = -1418.0
	Origin[2] = 33.0
	Format(Angles, sizeof(Angles),"0.0 360.0 0.0")
	SpawnHouseWall(Origin, Angles)
	Origin[0] = -996.0
	Origin[1] = -1531.0
	Origin[2] = -50.0
	Format(Angles, sizeof(Angles),"0.0 90.0 0.0")
	SpawnHouseWall(Origin, Angles)
	Origin[0] = -1002.0
	Origin[1] = -1548.0
	Origin[2] = 30.0
	Format(Angles, sizeof(Angles),"0.0 270.0 0.0")
	SpawnHouseWall(Origin, Angles)
	new String:mapname[256]
	GetCurrentMap(mapname, sizeof(mapname))
	if(!StrEqual(mapname, "dod_donner_extended"))
	{
		SpawnHouseDoor()
	}
	Origin[0] = -990.0
	Origin[1] = -1980.0
	Origin[2] = 7.0
	Format(Angles, sizeof(Angles),"90.0 270.0 0.0")
	SpawnHedges(Origin, Angles)
	Origin[1] = -2000.0
	Format(Angles, sizeof(Angles),"90.0 90.0 0.0")
	SpawnHedges(Origin, Angles)
	return Plugin_Handled
}

public SpawnHedges(Float:Origin[3], String:Angles[])
{
	new Hedge = CreateEntityByName("prop_physics_override")
	SetEntityModel(Hedge, "models/props_debris/walldestroyed05a.mdl")
	DispatchKeyValueVector(Hedge, "origin", Origin)
	DispatchKeyValue(Hedge, "angles", Angles)
	DispatchKeyValue(Hedge, "disableshadows", "1")
	DispatchKeyValue(Hedge, "spawnflags", "1544")
	DispatchKeyValue(Hedge, "solid", "2")
	DispatchKeyValue(Hedge, "fademindist", "0")
	DispatchKeyValue(Hedge, "fademaxdist", "0.1")
	DispatchSpawn(Hedge)
}

CreateDonnerTeamWall(Float:Origin[3])
{
	new teamwall
	teamwall = CreateEntityByName("func_team_wall")
	DispatchKeyValueVector(teamwall, "origin", Origin)
	DispatchKeyValue(teamwall, "blockteam", "2")
	DispatchSpawn(teamwall)
	teamwall = CreateEntityByName("func_team_wall")
	DispatchKeyValueVector(teamwall, "origin", Origin)
	DispatchKeyValue(teamwall, "blockteam", "3")
	DispatchSpawn(teamwall)
}


CreateTeamWall(Float:Origin[3])
{
	new teamwall = CreateEntityByName("func_team_wall")
	DispatchKeyValueVector(teamwall, "origin", Origin)
	DispatchKeyValue(teamwall, "blockteam", "3")
	DispatchSpawn(teamwall)
}

